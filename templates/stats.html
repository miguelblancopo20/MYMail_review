{% extends "base.html" %}
{% block body %}
  <header class="topbar">
    <div class="topbar-left">
      <img class="topbar-logo" alt="EY logo" src="{{ url_for('static', filename='img/ey.png') }}" onerror="this.style.display='none'" />
      <div class="topbar-title">Revisor de Mayordomo Mail <span class="version-badge">v{{ app_version }}</span></div>
    </div>
    <div class="topbar-fields">
      <div class="topbar-field"><span>Vista</span><strong>Estadísticas</strong></div>
      <div class="topbar-field"><span>Ventana</span><strong>{{ days }} días</strong></div>
    </div>
    <div class="topbar-right">
      <div class="pill">{{ current_user }}</div>
      <form method="get" class="actions" style="gap:6px">
        <input name="days" value="{{ days }}" inputmode="numeric" style="width:72px; padding:8px 10px; border-radius:12px; border:1px solid var(--line); font-size:12px" />
        <button class="btn btn-sm btn-ghost" type="submit">Días</button>
      </form>
      <a class="btn btn-ghost" href="{{ url_for('stats_listado') }}">Listado</a>
      <a class="btn btn-ghost" href="{{ url_for('review') }}">Continuar revisando</a>
      <a class="btn btn-logout" href="{{ url_for('logout') }}">Cerrar sesión</a>
    </div>
  </header>

  <main class="page page--full">
    <div class="stats-grid">
      <div class="card stat">
        <div class="stat-k">Revisiones (últimos {{ days }} días)</div>
        <div class="stat-v">{{ total_resultados }}</div>
      </div>
      <div class="card stat">
        <div class="stat-k">Descartes (últimos {{ days }} días)</div>
        <div class="stat-v">{{ total_descartes }}</div>
      </div>
      <div class="card stat">
        <div class="stat-k">KO% (sobre revisiones)</div>
        <div class="stat-v">{{ ko_rate }}</div>
      </div>
      <div class="card stat">
        <div class="stat-k">DUDA</div>
        <div class="stat-v">{{ duda_count }}</div>
      </div>
    </div>

    <div class="layout" style="grid-template-columns: 1fr 1fr; height:auto">
      <section class="section section--review">
        <div class="section-title">Estados (Top 10)</div>
        <div class="kv-list">
          {% for k,v,p in by_status %}
            <div class="kv-row kv-row-3"><div class="k">{{ k }}</div><div class="v">{{ v }}</div><div class="v">{{ p }}</div></div>
          {% endfor %}
        </div>
      </section>

      <section class="section section--act">
        <div class="section-title">Top Automatismos (Top 10)</div>
        <div class="kv-list">
          {% for k,v,p in top_automatismos %}
            <div class="kv-row kv-row-3"><div class="k">{{ k }}</div><div class="v">{{ v }}</div><div class="v">{{ p }}</div></div>
          {% endfor %}
        </div>
      </section>

      <section class="section section--agent">
        <div class="section-title">Revisiones por usuario</div>
        <div class="kv-list">
          {% for k,v in by_user %}
            <div class="kv-row"><div class="k">{{ k }}</div><div class="v">{{ v }}</div></div>
          {% endfor %}
        </div>
      </section>

      <section class="section section--mail">
        <div class="section-title">Actividad diaria</div>
        <div class="kv-list">
          {% for k,v in by_day %}
            <div class="kv-row"><div class="k">{{ k }}</div><div class="v">{{ v }}</div></div>
          {% endfor %}
        </div>
      </section>
    </div>
  </main>
{% endblock %}
